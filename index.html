<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus AI - Firebase Yönetim Merkezi</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>

    <style>
        /* CSS AYNI KALDI - Modern Glassmorphism */
        :root { --primary: #00ff88; --danger: #ff4d4d; --glass: rgba(255, 255, 255, 0.1); --text: #ffffff; }
        body, html { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #0f2027, #2c5364); height: 100vh; color: var(--text); }
        
        .auth-container { display: flex; justify-content: center; align-items: center; height: 100vh; }
        .glass-box { background: var(--glass); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.2); padding: 40px; border-radius: 20px; width: 350px; text-align: center; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; background: rgba(255,255,255,0.05); color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; background: var(--primary); color: #000; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        
        /* TİK ANİMASYONU */
        #success-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; justify-content: center; align-items: center; z-index: 9999; }
        .checkmark { width: 100px; height: 100px; border-radius: 50%; stroke: #fff; stroke-width: 2; animation: fill .4s ease-in-out .4s forwards; }
        @keyframes fill { 100% { box-shadow: inset 0px 0px 0px 50px var(--primary); } }

        /* PANEL */
        #admin-panel { display: none; padding: 30px; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--glass); padding: 20px; border-radius: 15px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        .content-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .panel-section { background: var(--glass); padding: 20px; border-radius: 15px; height: 400px; overflow-y: auto; }
        .user-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .btn-sm { width: auto; padding: 5px 10px; font-size: 12px; }
    </style>
</head>
<body>

    <div id="success-overlay">
        <svg class="checkmark" viewBox="0 0 52 52"><circle cx="26" cy="26" r="25" fill="none" stroke="#00ff88" stroke-width="2"/><path fill="none" stroke="#00ff88" d="M14.1 27.2l7.1 7.2 16.7-16.8"/></svg>
        <h2 style="margin-top:20px">Sisteme Bağlanıldı</h2>
    </div>

    <div id="auth-screen" class="auth-container">
        <div class="glass-box">
            <h1 style="color: var(--primary);">Nexus AI</h1>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="pass" placeholder="Şifre">
            <button onclick="login()">Güvenli Giriş</button>
        </div>
    </div>

    <div id="admin-panel">
        <header style="display:flex; justify-content: space-between;">
            <h2>Nexus AI - Patron Paneli</h2>
            <button onclick="logout()" style="width:100px">Çıkış</button>
        </header>

        <div class="dashboard-grid">
            <div class="stat-card"><h3>Aktif Kullanıcı</h3><h2 id="activeCount">0</h2></div>
            <div class="stat-card"><h3>Toplam Ziyaretçi</h3><h2 id="visitorCount">0</h2></div>
            <div class="stat-card"><h3>Yeni Öneriler</h3><h2 id="sugCount">0</h2></div>
        </div>

        <div class="content-grid">
            <div class="panel-section">
                <h3>Kullanıcı Kontrolü</h3>
                <div id="user-list"></div>
            </div>
            <div class="panel-section">
                <h3>Gelen Öneriler</h3>
                <div id="suggestion-list"></div>
            </div>
        </div>
    </div>

    <script>
        // BURAYA KENDİ FİREBASE BİLGİLERİNİ YAPIŞTIR PATRON
        const firebaseConfig = {
            apiKey: "AIzaSyCb7Ldqw_5jbLo6tcq93bPpK-O9uVb4fXU",
            authDomain: "deselwallet-3345f.firebaseapp.com",
            databaseURL: "https://deselwallet-3345f-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "deselwallet-3345f",
            storageBucket: "deselwallet-3345f.firebasestorage.app",
            messagingSenderId: "408489830274",
            appId: "1:408489830274:web:2fa8ff3d989e23efb1519b"
        };

        // Firebase Başlat
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // GİRİŞ FONKSİYONU
        function login() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('pass').value;

            auth.signInWithEmailAndPassword(email, pass)
                .then(() => {
                    document.getElementById('auth-screen').style.display = 'none';
                    document.getElementById('success-overlay').style.display = 'flex';
                    
                    setTimeout(() => {
                        document.getElementById('success-overlay').style.display = 'none';
                        document.getElementById('admin-panel').style.display = 'block';
                        loadData(); // Verileri Firebase'den çek
                    }, 2000);
                })
                .catch(err => alert("Hata: " + err.message));
        }

        // VERİLERİ ÇEKME (Realtime)
        function loadData() {
            // Ziyaretçi Sayısı
            database.ref('stats/visitors').on('value', snap => {
                document.getElementById('visitorCount').innerText = snap.val() || 0;
            });

            // Kullanıcıları Listele
            database.ref('users').on('value', snap => {
                const list = document.getElementById('user-list');
                list.innerHTML = "";
                let count = 0;
                snap.forEach(user => {
                    count++;
                    const data = user.val();
                    list.innerHTML += `
                        <div class="user-item">
                            <span>${data.username} (${data.isBlocked ? 'Engelli' : 'Aktif'})</span>
                            <button class="btn-sm" style="background:${data.isBlocked ? '#00ff88' : '#ff4d4d'}" 
                                onclick="toggleBlock('${user.key}', ${data.isBlocked})">
                                ${data.isBlocked ? 'Engeli Kaldır' : 'Engelle'}
                            </button>
                        </div>`;
                });
                document.getElementById('activeCount').innerText = count;
            });

            // Önerileri Listele
            database.ref('suggestions').on('value', snap => {
                const list = document.getElementById('suggestion-list');
                list.innerHTML = "";
                let sCount = 0;
                snap.forEach(sug => {
                    sCount++;
                    const d = sug.val();
                    list.innerHTML += `<div style="background:rgba(0,0,0,0.2); padding:10px; margin-bottom:5px; border-radius:10px;">
                        <strong>${d.email}:</strong> <p>${d.text}</p>
                    </div>`;
                });
                document.getElementById('sugCount').innerText = sCount;
            });
        }

        // ENGELLE / ENGEL KALDIR
        function toggleBlock(uid, currentStatus) {
            database.ref('users/' + uid).update({ isBlocked: !currentStatus });
        }

        function logout() { auth.signOut(); location.reload(); }
    </script>
</body>
</html>
